# Typecho IPLocation 插件

**Typecho IPLocation 插件** 是一个 Typecho 插件，用于显示评论者的 IP 地址及其属地信息。插件使用 [IP-INFO.CN](https://api.ip-info.cn/) API 来查询 IP 属地数据，并将结果缓存到本地，以减少频繁 API 调用。缓存时间为 86400 秒（24小时）。

---

## 功能简介

- 通过 IP-INFO.CN API 查询评论者 IP 的地理信息，可自行更换为其他接口。
- 缓存查询结果至本地 `cache.json` 文件，有效期为 24 小时，提升性能。
- 国内 IP：显示**省、市**以及 ISP 信息，如 `山东省 济南市 中国联通`。
- 国外 IP：显示国家、城市信息，如 `日本 东京都`。
- 支持显示或隐藏县级市地理位置。
- 支持显示或隐藏运营商信息。

---

## 安装与激活

1. 将插件文件夹 `IPLocation` 上传至 `Typecho` 的 `usr/plugins` 目录中，文件夹名称一定要为 `IPLocation`。
2. 在 Typecho 后台启用插件。
3. 插件激活时会自动创建 `cache.json` 文件用于存储缓存。

---

## 使用方法

在评论模板中，使用以下代码嵌入并显示评论者的 IP 属地信息：

```php
<?php echo IPLocation_Plugin::displayIPLocation($comments->ip); ?>
```

此代码会输出 IP 的属地信息，例如：

- **国内**：`IP属地：山东省 潍坊市 中国联通`
- **国外**：`IP属地：日本 东京都 xTom Japan Co., Ltd.`

详情请到我的博客查看：https://www.wanghaoyu.com.cn/archives/ip-location-plugin.html

---

## 缓存机制

- **缓存文件**：`cache.json` 文件位于插件目录下，所有 IP 查询结果都存储在该文件中。
- **缓存有效期**：24 小时（86400 秒）。每次查询时，会优先检查缓存，超过有效期则重新发起 API 请求。

---

## 配置选项

- **选择IP查询接口**：可选择不同的 IP 查询接口。
- **启用缓存**：启用此选项以缓存 IP 查询结果，减少 API 调用次数。
- **显示县级市地理位置**：启用此选项以显示县级市地理位置。
- **显示运营商信息**：启用此选项以显示运营商信息。

---

## 更新日志

### v1.4 (2024-12-24)
- 后台添加缓存控制的功能。
- 支持显示或隐藏县级市地理位置，运营商信息。

---

## 作者信息

- **作者**: 王浩宇
- **版本**: 1.4
- **更新日期**: 2024/12/24
- **网站**: [wanghaoyu.com.cn](https://www.wanghaoyu.com.cn)

---